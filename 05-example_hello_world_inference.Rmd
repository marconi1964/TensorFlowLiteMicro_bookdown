# Hello_world ç¯„ä¾‹ç¨‹å¼ - æ¨è«– {#chap-hello-world-inference}

æœ¬ç« ç¯€å°æ‡‰åˆ° [TinyML TensorFLow Lite æ©Ÿå™¨å­¸ç¿’ä¸­æ–‡ç‰ˆ](https://www.books.com.tw/products/0010865580) çš„ç¬¬å…­ç« . (åŸæ›¸ç¬¬äº”ç« æ˜¯èªªæ˜ hello_world åŸå§‹ç¨‹å¼åŠæ¸¬è©¦ç¢¼, å¯ä»¥ç•¶ä½œå¾ŒçºŒçš„ç ”ç©¶åˆ†æ, åˆ—å…¥ Â§é™„éŒ„ \@ref(appendixb) çš„ä¸»é¡Œ)

ä¸Šä¸€ç« , æˆ‘å€‘å·²ç¶“å»ºç«‹äº†å¯ä»¥è½‰ç§»åˆ°é–‹ç™¼æ¿ä¸ŠåŸ·è¡Œçš„æ¨¡å‹, æ¨¡å‹åªæ˜¯æ©Ÿå™¨å­¸ç¿’æ‡‰ç”¨ app çš„ä¸€éƒ¨åˆ†è€Œå·², TFLM æä¾›ä¸åŒé–‹ç™¼æ¿çš„ hello_world app, éœ€è¦åœ¨ç­†é›»ä¸Šå°‡æ¨¡å‹åŠ å…¥åŸå§‹ç¨‹å¼, é‡æ–°ç·¨è­¯æˆä¸åŒé–‹ç™¼æ¿å¯ä»¥åŸ·è¡Œçš„ç¨‹å¼ç¢¼(ä¸åŒ CPU çš„ç¨‹å¼ç¢¼ç„¡æ³•è·¨å¹³å°åŸ·è¡Œ), ä¹Ÿå¯ä»¥åœ¨ PC æˆ– Mac ä¸Šæ¨¡æ“¬çµæœ. 

æœ¬æ–‡ä»‹ç´¹å¯ä»¥é‹ä½œ hello_world ç¤ºç¯„ç¨‹å¼çš„æœ‰ä»¥ä¸‹çš„å‰å…©ç¨® (ç¶²è·¯ä¸Šæœ‰æ›´æ–°, å¯ä»¥æ”¯æ´æ›´å¤šè¨­å‚™):  

* [Arduino Nano 33 BLE Sense](#arduino-nano33-hello-world)  
* [ST Microelectronics STM32F746NG Discovery kit](#disco-f746ng-hello-world)  
* SparkFun Edge ([TinyML TensorFLow Lite æ©Ÿå™¨å­¸ç¿’ä¸­æ–‡ç‰ˆ](https://www.books.com.tw/products/0010865580) æ›¸ä¸Šæœ‰ä»‹ç´¹, ä½†æ‰‹ä¸Šæ²’æœ‰é€™å¡Šé–‹ç™¼æ¿, å°±ä¸ä»‹ç´¹äº†)   
* 2021/4/6 æ–°å¢å¯¦é©— [ESP32-CAM](#esp32-cam-hello-world)
* 2021/4/27 æ–°å¢å¯¦é©— [MaixPy Amigo (RISC-V CPU)](#riscv-amigo-hello-world)

<a id="disco_f746ng_hello_world"></a>  

## åœ¨ STM32 DISCO_F746NG ä¸Šå¯¦ç¾ hello_world {#disco-f746ng-hello-world}
### (ç„¡ç—›åŸ·è¡Œ)åœ¨ç­†é›»ä¸Šç·¨è­¯ç¨‹å¼, ä¸¦ä¸‹è¼‰è‡³ STM32 DISCO_F746NG

å› ç‚º TensorFlow Lite Micro çš„é–‹ç™¼æŒçºŒåœ¨é€²è¡Œ, éƒ¨ä»½æ–‡ä»¶ä¸¦æ²’æœ‰éš¨è‘—é–‹ç™¼é€²åº¦è€Œæ›´æ–°, å¦‚æœç…§è‘— github ä¸ŠåŸ·è¡Œæœƒç”¢ç”Ÿä¸€äº›éŒ¯èª¤, è€Œä¸”, åœ¨ç·¨è­¯ (make) ä¹‹å‰, éœ€è¦å°‡ STM32 DISCO_F746NG ç›¸é—œæª”æ¡ˆè¤‡è£½åˆ°ä¸»ç¨‹å¼ç›®éŒ„ä¸‹, å› æ­¤, æˆ‘åœ¨ github å‰µå»ºäº†ä¸€å€‹ branch, é‡å° DISCO_F746NG çš„é–‹ç™¼æ¿åšäº†æª”æ¡ˆå®‰æ’åŠè¨­å®šèª¿æ•´, å¯ä»¥ç›´æ¥ç·¨è­¯, ä¸¦ä¸‹è¼‰åˆ° DISCO_F746NG é–‹ç™¼æ¿ä¸ŠåŸ·è¡Œ. 

åƒè€ƒ[æˆ‘çš„ TFLM github - hello_world](https://github.com/marconi1964/tensorflow/blob/example/tensorflow/lite/micro/examples/hello_world/disco_f746ng/README_disco_f746ng.md)ç„¡ç—›åŸ·è¡Œ

åœ¨ä¸‹ä¸€ç¯€èªªæ˜å¦‚æœå¾ TFLM github å®˜ç¶²ä¸‹è¼‰å…§å®¹æ™‚, éœ€è¦åšçš„ä¿®æ”¹.

### (å¾®ç—›åŸ·è¡Œ)åœ¨ç­†é›»ä¸Šç·¨è­¯ç¨‹å¼, ä¸¦ä¸‹è¼‰è‡³ STM32 DISCO_F746NG
æ­¤ç¯€ä¹ƒé‡å°å·²ç¶“ç†Ÿæ‚‰ä¸Šä¸€ç¯€çš„å…§å®¹, é †åˆ©åŸ·è¡Œå¾Œ, é€²ä¸€æ­¥å¾ TFLM github å®˜ç¶²ä¸‹è¼‰, å¾—è‡ªè¡Œä¿®æ”¹éƒ¨ä»½å…§å®¹æ–¹èƒ½é †åˆ©åŸ·è¡Œç„¡èª¤.

**å‹•æ‰‹ä¿®æ”¹å…§å®¹**

éœ€è¦ä¿®æ”¹çš„å…§å®¹æœ‰  
1. æ”¹å¾ https://github.com/tensorflow å®˜ç¶²ä¸‹è¼‰  
2. å°‡ tensorflow/lite/micro/examples/hello_world/disco_f746ng/ é€™ç›®éŒ„æ”¹åæˆç‚º tensorflow/lite/micro/examples/hello_world/mbed/   
å…¶é¤˜å¾ make ä»¥å¾Œçš„æ“ä½œç¶­æŒè·ŸåŸå…ˆå…§å®¹ä¸è®Š

#### æ”¹å¾ https://github.com/tensorflow å®˜ç¶²ä¸‹è¼‰

```
# å¾æˆ‘çš„ github
$ git clone -b example --depth 1 https://github.com/marconi1964/tensorflow.git
# æ”¹åˆ°ç”¨ Tensorflow å®˜ç¶²çš„ github
$ git clone --depth 1 https://github.com/marconi1964/tensorflow.git
# æˆ–æ˜¯
$ git clone --depth 1 https://github.com/tensorflow/tensorflow.git
$ cd tensorflow
```

#### å°‡ tensorflow/lite/micro/examples/hello_world/disco_f746ng/ é€™ç›®éŒ„æ”¹åæˆç‚º tensorflow/lite/micro/examples/hello_world/mbed/

DISCO_F746NG çš„é©…å‹•ç¨‹å¼ (constant.cc èˆ‡ output_handler.cc) è·Ÿæ¨™æº–çš„ç¤ºç¯„ç¨‹å¼ä¸åŒ, éœ€è¦è®“ make æŠŠ F746NG çš„é©…å‹•ç¨‹å¼åŒ…å«åœ¨ä¸»ç¨‹å¼æ‰èƒ½åœ¨é–‹ç™¼æ¿ä¸ŠåŸ·è¡Œ, é€™éƒ¨åˆ†å·²ç¶“åœ¨ Makefile å®Œæˆ, åªæ˜¯ç›®å‰ Makefile çš„å¯«æ³•æ˜¯æ“·å– TARGET=mbed ä¸­çš„ 'mbed', å†åˆ° hello_world ç›®éŒ„ä¸‹å°‹æ‰¾ 'mbed' å­ç›®éŒ„ (é€™éƒ¨åˆ†çš„ç¨‹å¼è¨­å®šæœ‰å•é¡Œ, å·²ç¶“åœ¨ TensorFlow github ä¸Šç™¼ issue), è€Œ mbed å­ç›®éŒ„æ˜¯ä¸å­˜åœ¨, ä¸” Makefile ä¸æœƒå»å°‹æ‰¾ disco_f746ng å­ç›®éŒ„.


```
# æ¥çºŒä¸Šä¸€å€‹å‹•ä½œ, å·²ç¶“åœ¨ tensorflow ç›®éŒ„ä¸‹, åˆ‡æ›åˆ° hello_world ç¤ºç¯„ç¨‹å¼ç›®éŒ„
$ cd tensorflow/lite/micro/examples/hello_world/

$ mv disco_f746ng mbed
# å®Œæˆå¾Œ, å›åˆ° tensorflow ä¸»ç›®éŒ„ä¸‹
$ cd ~/tensorflow
```

(ä»¥ä¸Šçš„å‹•ä½œ, çœ‹èµ·ä¾†å¾ˆç°¡å–®, å»æ˜¯æˆ‘èŠ±æœ€å¤šæ™‚é–“çš„åœ°æ–¹, éœ€è¦å»äº†è§£ Makefile åŠå±¤å±¤ç–ŠåŠ ä¸Šçš„ Makefile.inc å’Œ *_makefile.inc çš„è¤‡é›œæ¶æ§‹.)  


ç¹¼çºŒåŸ·è¡Œ make ä»¥åŠå¾ŒçºŒçš„å‹•ä½œ

```
$ make -f tensorflow/lite/micro/tools/make/Makefile TARGET=mbed ALL_TAGS=disco_f746ng generate_hello_world_mbed_project
$ cd tensorflow/lite/micro/tools/make/gen/mbed_cortex-m4_default/prj/hello_world/mbed
$ mbed config root .
$ mbed deploy
$ mbed compile -m DISCO_F746NG -t GCC_ARM
```

#### å°‡ make å¾Œçš„ mbed.bin ä¸Šå‚³åˆ° DISCO_F746NG é–‹ç™¼æ¿

### (ç—›è‹¦çš„ debugéç¨‹) DISCO_F746NG åŸ·è¡Œ hello_world ç•¶æ©Ÿ
ç¬¬ä¸€æ¬¡åŸ·è¡Œæ™‚, é‚„ä¾†ä¸åŠæ²’æœ‰æ‰“é–‹ screen æ¥æ”¶ debug è¨Šæ¯, å°±ä¸€é¡†çƒåœ¨ä¸Šæ–¹å®šä½, æ‡·ç–‘æˆ‘çš„æ“ä½œ/æ“å®ˆæœ‰å•é¡Œ... æ‰“é–‹ screen, å‡ºç¾ ** Error message **

```
x_value: 1.0*2^-127, y_value: 1.0*2^-127

x_value: 1.4361557*2^-4, y_value: 1.7621826*2^-4

x_value: 1.4361557*2^-3, y_value: 1.8977352*2^-3

x_value: 1.0771168*2^-2, y_value: 1.389413*2^-2

x_value: 1.4361557*2^-2, y_value: 1.5588537*2^-2

x_value: 1.7951952*2^-2, y_value: 1.7960706*2^-2

x_value: 1.0771168*2^-1, y_value: 1.965511*2^-2

x_value: 1.2566366*2^-1, y_value: 1.1183078*2^-1

x_value: 1.4361557*2^-1, y_value: 1.3724688*2^-1

x_value: 1.6156756*2^-1, y_value: 1.4910772*2^-1

x_value: 1.7951952*2^-1, y_value: 1.6605182*2^-1

x_value: 1.9747147*2^-1, y_value: 1.7791265*2^-1

x_value: 1.0771168*2^0, y_value: 1.7791265*2^-1

x_value: 1.1668766*2^0, y_value: 1.8977352*2^-1

x_value: 1.2566366*2^0, y_value: 1.9316229*2^-1

x_value: 1.3463962*2^0, y_value: 1.965511*2^-1

x_value: 1.4361557*2^0, y_value: 1.0166438*2^0

++ MbedOS Fault Handler ++

FaultType: HardFault

Context:
R0: 7C
R1: 8
R2: FFDB4437
R3: 1
R4: 20002D58
R5: 34
R6: A
R7: FFDB4437
R8: 0
R9: 72
R10: 8
R11: 68
R12: 34
SP   : 2004FF8C
LR   : 800051B
PC   : 8000472
xPSR : 1000200
PSP  : 0
MSP  : 2004FF20
CPUID: 410FC271
HFSR : 40000000
MMFSR: 0
BFSR : 4
UFSR : 0
DFSR : 9
AFSR : 0
Mode : Thread
Priv : Privileged
Stack: MSP

-- MbedOS Fault Handler --



++ MbedOS Error Info ++
Error Status: 0x80FF013D Code: 317 Module: 255
Error Message: Fault exception
Location: 0x8000472
Error Value: 0x20002E34
For more info, visit: https://mbed.com/s/error?error=0x80FF013D&tgt=DISCO_F746NG
-- MbedOS Error Info --

```

æŸ¥çœ‹ https://mbed.com/s/error?error=0x80FF013D&tgt=DISCO_F746NG è¼¸å…¥éŒ¯èª¤ç¢¼ (error code) 0x80FF013D å¾Œæœƒç”¢ç”Ÿä»¥ä¸‹è¨Šæ¯

```

Error Decoder
0x80FF013D
Type:
System
Module
Unknown module
Error Code
HardFault exception
Cortex-M HardFault exception has occurred. Please see https://os.mbed.com/docs/latest/tutorials/analyzing-mbed-os-crash-dump.html for more info.

```

é€²ä¸€æ­¥æŸ¥çœ‹ https://os.mbed.com/docs/latest/tutorials/analyzing-mbed-os-crash-dump.html


```
The following Cortex-M fault exceptions trigger the Mbed OS fault exception handler.

    MemManage Exception - Memory accesses that violate the setup in the MPU and certain illegal memory accesses trigger memory management faults.
    BusFault Exception - When an error response is received during a transfer on the AHB interfaces, it produces bus faults.
    UsageFault Exception - Division by zero, unaligned accesses and trying to execute coprocessor instructions can cause usage faults.
    HardFault Exception - Triggered on all fault conditions or if the corresponding fault handler (one of the above) is not enabled.

```
çŒœå¯èƒ½æ˜¯è¨˜æ†¶é«”å•é¡Œ, å†çœ‹ä¸€ä¸‹è¢å¹•ç•¶æ©Ÿæ™‚, çƒæ˜¯åœ¨è¢å¹•çš„æœ€ä¸Šæ–¹, æ˜¯å¦æ˜¯è¶…éè¢å¹•çš„ç¯„åœè€Œé€ æˆéŒ¯èª¤, çœ‹ä¸€ä¸‹åŸå§‹æª”æ¡ˆ output_handler.cc è·Ÿ error message å¯èƒ½æ˜¯æœ‰è¡çªçš„.


```
# error message
x_value: 1.4361557*2^0, y_value: 1.0166438*2^0

# output_handler.cc
    y_pos = dot_radius + static_cast<int>(midpoint * (1.f - y_value));     # åŸå§‹ç¨‹å¼æœƒæœ‰å•é¡Œ

    y_pos = dot_radius + static_cast<int>(midpoint * (1.1f - y_value));    # å°èª¿æ•´å¾Œå³å¯æ­£å¸¸é‹ä½œ

```

<a id="arduino_nano33_hello_world"></a>  

## åœ¨ Arduino Nano 33 BLE ä¸Šå¯¦ç¾ hello_world {#arduino-nano33-hello-world}

åœ¨ Â§\@ref(arduinoide) Arduino IDE å®‰è£å¾Œ, å°‡ Arduino Nano 33 BLE æ¥ä¸Šé›»è…¦çš„ USB, é€²å…¥ Arduino IDE çš„ Tools - Boards åŠ Port ç¢ºå®šå·²ç¶“å®‰è£å®Œæˆ, å†åˆ° File - Examples æ‰¾åˆ° Arduino_TensorFlowLite ä¸‹æœƒæœ‰ 4 å€‹ç¯„ä¾‹  

* hello_world  
* magic_wand  
* micro_speech  
* person_detection  

é¸æ“‡æˆ‘å€‘æƒ³è¦çš„ç¯„ä¾‹ hello_world åŸ·è¡Œå³å¯.

åŸ·è¡Œä¸­, å¯ä»¥æ‰“é–‹ Arduino IDE menu   
* Tool - Serial Monitor : çœ‹åˆ° Nano 33 å›é¥‹çš„é æ¸¬ Xã€Y å€¼ 
* Tool - Serial Plotter : çœ‹åˆ° Nano 33 å›é¥‹çš„é æ¸¬ Xã€Y å€¼å±•é–‹çš„åœ–å½¢

åŒæ™‚, Nano 33 çš„ç‡ˆè™Ÿä¹Ÿæœƒéš¨è‘—è¾¨è­˜çµæœ, é€æ¼¸è®Šäº®åˆ°ç†„æ»…å†è®Šäº®

## åœ¨ ESP32-CAM ä¸Šå¯¦ç¾ hello_world {#esp32-cam-hello-world}

é€™è£¡ä¸èªªæ˜ Arduino çš„ä½œæ³•(ä½œæ³•æ›´ Arduino Nano 33 å¤§åŒå°ç•°), åƒ…å°± esp-idf æ–¹æ³•åšèªªæ˜  

åœ¨ Â§\@ref(esp-idf) esp-idf å®‰è£ä¸”æ¸¬è©¦å®Œ ESP32 çš„ hello world å¾Œ, ç¾åœ¨æ¸¬è©¦çš„æ˜¯ TensorFlow Lite Micro çš„ hello_world. é¡ä¼¼ STM32 DISCO_F746NG çš„ Makefile çš„ä½œæ³•

åœ¨ idf.py build é€™æ­¥é©Ÿå‡ºç¾éŒ¯èª¤  

```
$ git clone https://github.com/tensorflow/tensorflow.git
$ cd tensorflow
$ make -f tensorflow/lite/micro/tools/make/Makefile TARGET=esp generate_hello_world_esp_project
$ cd tensorflow/lite/micro/tools/make/gen/esp_xtensa-esp32/prj/hello_world/esp-idf
$ idf.py build

-- Configuring done
CMake Error at /home/rafael/esp/esp-idf/tools/cmake/project.cmake:461 (target_link_libraries):
Error evaluating generator expression:

$<IN_LIST:-DTF_LITE_STATIC_MEMORY,$<TARGET_PROPERTY:__idf_tfmicro,COMPILE_OPTIONS>>
Expression did not evaluate to a known generator expression
Call Stack (most recent call first):
CMakeLists.txt:3 (project)

CMake Error in main/CMakeLists.txt:
Error evaluating generator expression:

$<IN_LIST:-DTF_LITE_STATIC_MEMORY,$<TARGET_PROPERTY:__idf_tfmicro,COMPILE_OPTIONS>>
Expression did not evaluate to a known generator expression

-- Generating done
-- Build files have been written to: /home/rafael/tensorflow/tensorflow/lite/micro/tools/make/gen/esp_xtensa-esp32/prj/hello_world/esp-idf/build
cmake failed with exit code 1
```

Google å¾Œç™¼ç¾ [ESP32 Hello World project crashing in the target](https://github.com/tensorflow/tensorflow/issues/42165#issuecomment-751882110) èªªæ˜ cmake çš„ compile option éœ€è¦ 3.11 ç‰ˆæœ¬ä»¥ä¸Š, æŸ¥äº†æˆ‘çš„ cmake ç‰ˆæœ¬æ˜¯ 3.10.2, æ‰€ä»¥éœ€è¦å‡ç´š  

```
$ cmake --version
cmake version 3.10.2
```

[cmake å‡ç´šä½œæ³•](https://askubuntu.com/questions/829310/how-to-upgrade-cmake-in-ubuntu)

```
# å¾ https://cmake.org/download/ ä¸‹è¼‰ tar file, åˆ°ä¸‹è¼‰ tar file çš„ç›®éŒ„ä¸‹åŸ·è¡Œ:

$ cd $CMAKE_DOWNLOAD_PATH
$ ./configure
$ make
$ sudo make install
```

å†åŸ·è¡Œ idf, å¯ä»¥çµæŸå¾é–‹ç™¼æ¿å‚³å›ä¾†çš„ X è·Ÿ Y çš„å€¼  

```
$ idf.py build
$ idf.py -p PORT flash monitor 
```

æé†’ : åŸ·è¡Œ monitor ç¨‹å¼æ™‚, å¦‚æœè¦é›¢é–‹, éœ€è¦æŒ‰ â€˜Ctrlâ€™ + â€˜]â€™ çš„çµ„åˆéµ.


## åœ¨ MaixPy Amigo (RISC-V CPU) ä¸Šå¯¦ç¾ hello_world {#riscv-amigo-hello-world}   

### å»ºç«‹ MaixPy tool chains

<span style="color:red">âš ï¸æ³¨æ„ æˆªæ­¢ç›®å‰ç‚ºæ­¢, é‚„æœ‰å•é¡Œ, è«‹ä¸è¦è¼•æ˜“å˜—è©¦, æ­¡è¿æå‡ºæ”¹å–„å»ºè­°</span>

ç…§è‘— [Build Maixpy from source code](https://github.com/sipeed/MaixPy/blob/master/build.md) æ­¥é©ŸåŸ·è¡Œ

#### Get source code

```
# Clone by https link
$ git clone https://github.com/sipeed/maixpy.git
# Then get submodules
$ cd maixpy
$ git submodule update --init
```
#### Install dependencies  

```
$ sudo apt update
$ sudo apt install python3 python3-pip build-essential cmake
$ cd maixpy     # if you ever change directory 
$ pip3 install -r requirements.txt
```
#### Download toolchain

Download the latest toolchain from [here](https://github.com/kendryte/kendryte-gnu-toolchain/releases) (macOS and linux), or [kendryte-toolchain-ubuntu-amd64-8.2.0-20190409.tar.xz(CDN)](http://dl.cdn.sipeed.com/kendryte-toolchain-ubuntu-amd64-8.2.0-20190409.tar.xz) (for linux)

And extract to /opt/kendryte-toolchain/

```
$ cd ~
$ wget http://dl.cdn.sipeed.com/kendryte-toolchain-ubuntu-amd64-8.2.0-20190409.tar.xz
$ sudo tar -Jxvf kendryte-toolchain-ubuntu-amd64-8.2.0-20190409.tar.xz -C /opt
$ ls /opt/kendryte-toolchain/bin
```

#### Configure project

##### åˆ‡æ›åˆ° projects/hello_world ç›®éŒ„æˆ– projects/maixpy_k210, å¿…é ˆéµå¾ªå®ƒçš„ç›®éŒ„çµæ§‹æ‰å¯ä»¥é †åˆ©åŸ·è¡Œ, åƒç…§ Reference æ–‡ç« èªªæ˜.

```
$ cd maixpy
$ cd projects/hello_world
# æˆ–
$ cd maixpy
$ cd projects/maixpy_k210

# æˆ‘çš„ä½œæ³•æ˜¯è¤‡è£½ hello_world åˆ°æ–°çš„ç›®éŒ„ amigo_tflm
$ cd maixpy
$ cp -r projects/hello_world/ projects/amigo_tflm/
$ cd projects/amigo_tflm
```  
  
##### Configure project
Usually, just use the default configuration.

If you want to customsize project modules, execute command:

```
python3 project.py menuconfig
```

æ¥ä¸‹ä¾†, åœ¨ build ä¹‹å‰, æˆ‘å€‘å…ˆä¸‹è¼‰ tensorflow lite micro ç¨‹å¼

### ä¸‹è¼‰ TensorFlow lite micro, åŸ·è¡Œ make ä¾†ç”¢ç”Ÿ source code
#### é¡ä¼¼ DISCO_F746NG çš„ä½œæ³•ä¸‹è¼‰åŠåŸ·è¡Œ make 

```
$ git clone https://github.com/tensorflow/tensorflow.git
$ cd tensorflow
# ä¿®æ”¹ tensorflow å‘½å riscv32_mcu èˆ‡ riscv_mcu / mcu_riscv ä¸ä¸€è‡´è™•
$ mv tensorflow/lite/micro/tools/make/targets/mcu_riscv_makefile.inc \
     tensorflow/lite/micro/tools/make/targets/riscv32_mcu_makefile.inc
$ mv tensorflow/lite/micro/riscv_mcu/ tensorflow/lite/micro/riscv32_mcu/
$ make -f tensorflow/lite/micro/tools/make/Makefile TARGET=riscv32_mcu generate_hello_world_make_project
# source code ä½æ–¼ tensorflow/micro/tools/make/gen/riscv32_mcu_riscv32_mcu_micro/prj/hello_world/make/
$ cd tensorflow/micro/tools/make/gen/riscv32_mcu_riscv32_mcu_micro/prj/hello_world/make/
$ ls
LICENSE  Makefile README_MAKE.md  tensorflow  third_party
# å¯ä»¥å…ˆçœ‹ Makefile çš„å…§å®¹ 
# SRCS := \
# tensorflow/lite/micro/simple_memory_allocator.cc .......
# éœ€è¦å°‡é€™éƒ¨åˆ†çš„ SRCS å…§å®¹è¤‡è£½åˆ° MaixPy çš„ maixpy/projects/amigo_tflm/main/CMakeList.txt çš„ Add source files ä¸‹
# å†åº¦çœ‹äº†å…¨éƒ¨æª”æ¡ˆ, ç™¼ç¾ä¸¦æ²’æœ‰ hello_world çš„ç¨‹å¼åˆ—è¡¨ ğŸ˜„ é‚„æœ‰ä¸€æ®µè·¯è¦èµ°
```

### å°‡ tensforflow çš„ source code æª”æ¡ˆæ•´ç†æˆ MaixiPy tool chain çš„æª”æ¡ˆæ¶æ§‹
ç›®å‰çš„æ¢ç´¢éœ€è¦æ‰‹å‹•æ•´ç†è¨±å¤šæª”æ¡ˆ, è€Œä¸”ç›®å‰ç‚ºæ­¢é‚„æœ‰éŒ¯èª¤, é‚„ä¸ç¢ºå®šå“ªè£¡éœ€è¦ä¿®æ­£

#### è¤‡è£½ Tensorflow åŸå§‹ç¢¼åˆ° MaixPy åŸå§‹æª”ç›®éŒ„

```
$ cd ~/tensorflow
$ cp -r tensorflow/micro/tools/make/gen/riscv32_mcu_riscv32_mcu_micro/prj/hello_world/make/ \
        ~/maixpy/projects/amigo_tflm
$ cd ~/maixpy/projects/amigo_tflm
``` 

#### ä¿®æ”¹ MaixPy build çš„ç›¸é—œè¨­å®š

1. ä¿®æ”¹ CMakeList.txt çš„ C/C++ åŸå§‹ç¨‹å¼ç¢¼æª”æ¡ˆè¨­å®š  
  * ä¿®æ”¹ ~/maixpy/projects/amigo_tflm/main/CMakeLists.txt æª”æ¡ˆå…§å®¹
  
```
# å°‡ç›®å‰ç›®éŒ„ . è¨­æˆ include ç›®éŒ„
############## Add include ###################
list(APPEND ADD_INCLUDE "."
   )
# list(APPEND ADD_PRIVATE_INCLUDE "")
###############################################

# å°‡ä¸Šä¸€å€‹å‹•ä½œçš„çµæœç”¢ç”Ÿçš„ ensorflow/micro/tools/make/gen/riscv32_mcu_riscv32_mcu_micro/prj/hello_world/make/Makefile å…§å®¹
# SRCS := \
# tensorflow/lite/micro/simple_memory_allocator.cc ....... 
# çš„æ‰€æœ‰ .cc æª”æ¡ˆåç¨±è¤‡è£½è²¼ä¸Š, ç”¨é›™å¼•è™Ÿéš”é–‹
############## Add source files ###################
list(APPEND ADD_SRCS
"tensorflow/lite/micro/simple_memory_allocator.c"
.....
   )
###############################################

```

2. ä¿®æ”¹ çš„ C/C++ ç·¨è­¯è¨­å®š  
  * ä¿®æ”¹ ~/maixpy/projects/amigo_tflm/compile/compile_flags.cmake

```
# åŸå…ˆè¨­å®š
set(CMAKE_CXX_FLAGS -mcmodel=medany
...
                    -std=gnu11
# å°‡ -std=gnu11 æ”¹æˆ -std=c++11
set(CMAKE_CXX_FLAGS -mcmodel=medany
...
                    -std=c++11

```
3. å‡ºç¾ error  


References:  

* [Sipeed MaixPy å®˜ç¶²](https://maixpy.sipeed.com/dev/en/advanced/code_struct.html)
* [Sipeed MaixPy æ–‡ä»¶èªªæ˜](https://wiki.sipeed.com/soft/maixpy/zh/)
* [Build Maixpy from source code](https://github.com/sipeed/MaixPy/blob/master/build.md)
* [Simple and configurable C/C++ project/SDK template - CMake](https://github.com/Neutree/c_cpp_project_framework)  
